!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.e)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.e?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.buildQuery=function(e,n){return{table:e,action:n,state:"pending",result:[],time:Date.now(),queryID:t.uuid(),extend:[],comments:[]}},t.noop=function(){},t.throwErr=function(e){throw new Error(e)},t.u=function(e){return e?JSON.parse(JSON.stringify(e)):null},t.compareObjects=function(e,n){if(e===n)return!0;if("object"!=typeof e)return!1;if(!e||!n)return!1;var r=Array.isArray(e),i=Object.keys(e),o=r?e.length===n.length:i.length===Object.keys(n).length;if(!o)return!1;for(var s=i.length;s--&&o;){var a=i[s];o="object"==typeof e[a]?t.compareObjects(e[a],n[a]):e[a]===n[a]}return o},t.chainAsync=function(e,n){return new Promise(function(r,i){if(e&&e.length){var o=[],s=0,a=function(){s<e.length?n(e[s],s,function(e){e&&o.push(e||0),++s%500==0?t.setFast(a):a()},function(e){i(e)}):r(o.length?o:void 0)};a()}else r([])})},t.allAsync=function(e,t){return Promise.all((e||[]).map(function(e,n){return new Promise(function(r,i){t(e,n,r,i)})}))};var n="undefined"==typeof window?"":navigator.userAgent||"";t.isSafari=0!==n.length&&(/^((?!chrome|android).)*safari/i.test(n)||/iPad|iPhone|iPod/.test(n)&&!window.MSStream),t.isMSBrowser=0!==n.length&&(n.indexOf("MSIE ")>0||n.indexOf("Trident/")>0||n.indexOf("Edge/")>0),t.isAndroid=/Android/.test(n),t.random16Bits=function(){if("undefined"==typeof crypto)return Math.round(Math.random()*Math.pow(2,16));if(crypto.getRandomValues){var e=new Uint16Array(1);return crypto.getRandomValues(e),e[0]}return"undefined"!=typeof global&&global.f.randomBytes?global.f.randomBytes(2).reduce(function(e,t){return t*e}):Math.round(Math.random()*Math.pow(2,16))},t.throttle=function(e,t){var n=!1;return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];n||(n=!0,setTimeout(function(){e.apply(null,r),n=!1},t))}},t.timeid=function(e){for(var n=Math.round((new Date).getTime()/(e?1:1e3)).toString();n.length<(e?13:10);)n="0"+n;return n+"-"+(t.random16Bits()+t.random16Bits()).toString(16)},t.intersect=function(e,t){return!(!e||!t)&&!(!e.length||!t.length)&&(e||[]).filter(function(e){return-1!==(t||[]).indexOf(e)}).length>0},t.uuid=function(){var e,n,r="";return[r,r,r,r,r,r,r,r].reduce(function(i,o,s){for(e=t.random16Bits(),n=3===s?4:4===s?(e%16&3|8).toString(16):r,e=e.toString(16);e.length<4;)e="0"+e;return i+([2,3,4,5].indexOf(s)>-1?"-":r)+(n+e).slice(0,4)},r)},t.hash=function(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString(16)};var r={int:function(e){return e},uuid:t.uuid,timeId:function(){return t.timeid()},timeIdms:function(){return t.timeid(!0)}};t.generateID=function(e,t){return r[e]?r[e](t||1):""},t.cleanArgs=function(e,n){for(var r={},i=e.length;i--;){var o=e[i].split(":");o.length>1?r[o[0]]=t.cast(o[1],n[o[0]]||void 0,!0):r[o[0]]=n[o[0]]||void 0}return r},t.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},t.objSort=function(e,n){return function(r,i){var o=e?t.objQuery(e,r)>t.objQuery(e,i)?-1:1:r>i?-1:1;return n?-1*o:o}},t.cast=function(e,n,r){if("any"===e||"blob"===e)return n;if(-1!==e.indexOf("[]")){var i=e.slice(0,e.lastIndexOf("[]"));return Array.isArray(n)?n.map(function(e){return t.cast(i,e,r)}):[]}var o=typeof n,s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},a=function(e,i){switch(e){case"safestr":return a("string",i).replace(/[&<>"'`=\/]/gim,function(e){return s[e]});case"int":return"number"!==o||i%1!=0?parseInt(i||0):i;case"number":case"float":return"number"!==o?parseFloat(i||0):i;case"array":return Array.isArray(i)?i:[];case"uuid":case"timeId":case"timeIdms":case"string":return"string"!==o?String(i):i;case"object":case"obj":case"map":return t.isObject(i)?i:{};case"boolean":case"bool":return!0===i||1===i}return r?n:null};if(void 0===n||null===n)return null;var u=a(String(e||"").toLowerCase(),n);return void 0!==u&&["int","float","number"].indexOf(e)>-1&&isNaN(u)?0:u},t.a=function(e){return Object.isFrozen(e)?t.u(e):e},t.deepFreeze=function(e){return Object.getOwnPropertyNames(e||{}).forEach(function(n){var r=e[n];"object"==typeof r&&null!==r&&(e[n]=t.deepFreeze(r))}),Object.freeze(e)},t.crowDistance=function(e,t,n,r,i){void 0===i&&(i=6371);var o=function(e){return e*(Math.PI/180)},s=o(n-e),a=o(r-t),u=Math.sin(s/2)*Math.sin(s/2)+Math.cos(o(e))*Math.cos(o(n))*Math.sin(a/2)*Math.sin(a/2);return i*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)))};var i={};t.resolveObjPath=function(e,t){var n=e+(t?"0":"1");if(i[n])return i[n];var r=e.indexOf("[")>-1?e.split(/\.|\[/gim).map(function(e){return e.replace(/\]/gim,"")}):e.split(".");if(t){var o=r.shift()+"."+r.shift();r.unshift(o)}return i[n]=r,i[n]},t.getFnValue=function(e,n,r){return n.match(/\".*\"|\'.*\'/gim)?n.replace(/\"(.*)\"|\'(.*)\'/gim,"$1"):t.objQuery(n,e,r)},t.objQuery=function(e,n,r){var i=function(e,t,n){return e[t]&&n?i(e,t+1,n[e[t]]):n};return i(Array.isArray(e)?e:t.resolveObjPath(e,r),0,n)};var o=0,s={},a=Array.prototype.slice,u="undefined"!=typeof window&&window.postMessage&&window.addEventListener,c=function(e){return e[0].apply(null,a.call(e,1))};u&&window.addEventListener("message",function(e){var t,n=e.data;"string"==typeof n&&0===n.indexOf("setMsg")&&(t=s[n])&&(delete s[n],c(t))});t.setFast=u?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=o++,r="setMsg"+n;return s[r]=e,window.postMessage(r,"*"),n}:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];"undefined"!=typeof global?global.setImmediate(function(){c(e)}):setTimeout(function(){c(e)},0)}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.fast=0]="fast",e[e.medium=1]="medium",e[e.slow=2]="slow",e[e.fn=3]="fn",e[e.none=4]="none"}(t.IWhereType||(t.IWhereType={}))},function(e,t,n){e.exports=n(3)},function(e,t,n){var r=this&&this.h||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(4),s=n(0),a=n(5),u=n(6),c=n(8),l=n(9),f=n(10),h=n(11),p=n(12),y=n(13);"undefined"!=typeof global&&(i=global.v);var d=2,g=new c({concurrency:1}),v=function(){function e(){this.version=d,this.earthRadius=6371,this.state={activeAV:"",hasAnyEvents:!1,peers:[],pid:s.uuid(),id:s.uuid(),peerEvents:[],focused:!0,peerMode:!1,connected:!1,ready:!1,selectedTable:""},this.tables={},this.plugins=[],this.b={},this.indexTypes={string:function(e){return"object"==typeof e?JSON.stringify(e):String(e)},geo:function(e){},float:function(e){var t=parseFloat(e);return isNaN(t)?0:t},int:function(e){var t=parseInt(e);return isNaN(t)?0:t},number:function(e){var t=parseFloat(e);return isNaN(t)?0:t}},this.y={Core:new o.ReallySmallEvents},this.g=this.g.bind(this),u.attachDefaultFns(this)}return e.prototype.doFilter=function(e,t){var n=this;return this.filters[e]?new Promise(function(r,i){s.chainAsync(n.filters[e],function(r,o,s){n.filters[e][o](t).then(function(e){t=e,e.abort?i(e.abort):s()})}).then(function(){r(t.result)})}):Promise.resolve(t.result)},e.prototype.getCache=function(e,t){if(!this.b[e])throw new Error('Cache "'+e+'" not found!');return t?this.b[e].slice(t.offset,t.offset+t.limit):this.b[e].slice()},e.prototype.clearCache=function(e){var t=void 0!==this.b[e];return delete this.b[e],t},e.prototype.clearTTL=function(e){var t=this,n=this.state.selectedTable+"."+e;return new Promise(function(e,i){t.triggerQuery(r({},s.buildQuery("_ttl","delete"),{where:["key","=",n]}),s.noop,e,i)})},e.prototype.expires=function(e){var t=this;return new Promise(function(n,i){var o=t.state.selectedTable+"."+e,a=[];t.triggerQuery(r({},s.buildQuery("_ttl","select"),{where:["key","=",o]}),function(e){a.push(e)},function(){a.length?n({time:(a[0].date-Date.now())/1e3,cols:a[0].cols}):n({time:-1,cols:[]})},i)})},e.prototype.g=function(){var e=this;if(!this.config.disableTTL){this.w&&clearTimeout(this.w);var t=0,n=0,i=function(){var o=[];e.triggerQuery(r({},s.buildQuery("_ttl","select"),{limit:20,offset:20*t}),function(e){o.push(e)},function(){o.length?s.chainAsync(o,function(t,i,o){if(t.date<Date.now()){var a=function(){e.triggerQuery(r({},s.buildQuery("_ttl","delete"),{where:["key","=",t.key]}),s.noop,o,s.throwErr)},u=t.key.split("."),c=u[0],l=-1===["float","int","number"].indexOf(e.tables[c].pkType)?u[1]:parseFloat(u[1]);if(t.cols.length){var f={};t.cols.forEach(function(e){f[e]=null}),e.triggerQuery(r({},s.buildQuery(c,"upsert"),{actionArgs:f,where:[e.tables[c].pkCol,"=",l]}),s.noop,a,s.throwErr)}else e.triggerQuery(r({},s.buildQuery(c,"delete"),{where:[e.tables[c].pkCol,"=",l]}),s.noop,a,s.throwErr)}else n=Math.max(n,t.date),o()}).then(function(){t++,i()}):n&&(e.w=setTimeout(e.g,n-Date.now()))},s.throwErr)};i()}},e.prototype.selectTable=function(e){return e&&(this.state.selectedTable=e),this},e.prototype.getPeers=function(){return JSON.parse(localStorage.getItem("nsql-peers-"+this.state.id)||"[]")},e.prototype.O=function(){return"undefined"==typeof window?"ROCKS":s.isSafari?"WSQL":"undefined"!=typeof indexedDB?"IDB":"undefined"!=typeof window&&void 0!==window.openDatabase?"WSQL":"LS"},e.prototype._=function(e){var t=this;return new Promise(function(n,r){var i={};(e.plugins||[]).forEach(function(e){(e.filters||[]).forEach(function(e){i[e.name]||(i[e.name]=[]);for(var t=e.priority;i[e.name][t];)t++;i[e.name][t]=e.callback})}),Object.keys(i).forEach(function(e){t.filters[e]=[],i[e].forEach(function(n){n&&t.filters[e].unshift(n)})});var o=function(e,t){return!t||!t.length||(1===t.length?e>=t[0]:e>=t[0]&&e<t[1])},s=!1;(e.plugins||[]).forEach(function(t){if(t.dependencies){var n=t.dependencies||{};Object.keys(t.dependencies).forEach(function(i,a,u){if("core"===i)o(d,n[i])||(s=!0,r('Plugin "'+t.name+'" requires a different core version of nano-sql!'));else{var c=(e.plugins||[]).reduce(function(e,t){return t.name===i?t:e});c||(s=!0,r('Plugin "'+t.name+'" requires plugin "'+i+"\" but it isn't installed!")),o(c.version,n[i])||(s=!0,r('Plugin "'+t.name+'" requires a different version of "'+i+'"!'))}})}}),s||n()})},e.prototype.connect=function(e){var t=this;return new Promise(function(n,r){return t._(e)}).then(function(){return t.doFilter("config",{result:e})}).then(function(n){return t.state.id=e.id||"nSQL_DB",t.config=n,"undefined"!=typeof window&&n&&n.peer&&(t.state.peerMode=!0),t.doFilter("willConnect",{result:{}})}).then(function(){return new Promise(function(e,n){var r=void 0!==t.config.mode?t.config.mode:"TEMP";if("string"==typeof r)switch("PERM"===r&&(r=t.O()),r){case"TEMP":t.adapter=new f.SyncStorage(!1);break;case"LS":t.adapter=new f.SyncStorage(!0);break;case"WSQL":t.adapter=new h.WebSQL;break;case"IDB":t.adapter=new p.IndexedDB;break;case"ROCKS":case"LVL":t.adapter=new i;break;default:n("Cannot find mode "+r+"!")}else t.adapter=r;t.adapter.plugin&&(t.config.plugins||[]).push(t.adapter.plugin),t._(t.config).then(function(){t.adapter.nSQL=t,t.adapter.connect(t.state.id,e,n)}).catch(n)})}).then(function(){t.triggerEvent({target:"Core",targetId:t.state.id,events:["connect"],time:Date.now()}),t.state.connected=!0;var e=["_util","_ttl"].concat((t.config.tables||[]).map(function(e){return e.name}));return s.allAsync(e,function(e,n,i,o){switch(e){case"_util":t.triggerQuery(r({},s.buildQuery("create table",""),{model:{name:"_util",model:[{key:"key:string",props:["pk()"]},{key:"value:any"}],S:!0}}),s.noop,i,o);break;case"_ttl":t.triggerQuery(r({},s.buildQuery("create table",""),{model:{name:"_ttl",model:[{key:"key:string",props:["pk()"]},{key:"table:string"},{key:"cols:string[]"},{key:"date:number"}],S:!0}}),s.noop,i,o);break;default:var a=(t.config.tables||[]).filter(function(t){return t.name===e})[0];if(!a)return void o("Table not found!");t.triggerQuery(r({},s.buildQuery("create table",""),{model:a}),s.noop,i,o)}})}).then(function(){return new Promise(function(e,n){var i;t.triggerQuery(r({},s.buildQuery("_util","select"),{where:["key","=","version"]}),function(e){e&&(i=e.value)},function(){!i||i<2?t.triggerQuery(r({},s.buildQuery("_util","upsert"),{actionArgs:{key:"version",value:d}}),s.noop,e,n):e()},n)})}).then(function(){return new Promise(function(e,n){var i;t.config.version?t.triggerQuery(r({},s.buildQuery("_util","select"),{where:["key","=","db-version"]}),function(e){e&&(i=e.value)},function(){var o=function(e,n,i){t.triggerQuery(r({},s.buildQuery("_util","upsert"),{actionArgs:{key:"db-version",value:e}}),s.noop,n,i)};if(i){var a=function(){if(i===t.config.version)o(t.config.version||0,e,n);else{if(!t.config.onVersionUpdate)return void o(t.config.version||0,e,n);t.config.onVersionUpdate(i).then(function(e){o(i=e,function(){s.setFast(a)},n)}).catch(n)}};a()}else o(t.config.version||0,e,n)},n):e()})}).then(function(){return new Promise(function(e,n){t.triggerEvent({target:"Core",targetId:t.state.id,events:["ready"],time:Date.now()}),t.state.ready=!0,t.config.disableTTL||t.g(),t.config.peer&&t.N(),e()})})},e.prototype.N=function(){var e=this,n=0;this.state.pid=s.uuid(),this.state.peers=this.getPeers(),this.state.peers.unshift(this.state.pid),localStorage.setItem("nsql-peers-"+this.state.id,JSON.stringify(this.state.peers)),window.addEventListener("storage",function(t){if(t.key==="nsql-peers-"+e.state.id&&(e.state.peers=e.getPeers()),t.key&&0===t.key.indexOf(e.state.pid+".")){localStorage.removeItem(t.key);var i=JSON.parse(t.newValue||"{}");e.state.peerEvents.push(i.query.queryID||""),e.triggerEvent(r({},i,{types:["peer-change"]})),s.setFast(function(){e.triggerEvent(i)})}if(++n>50&&e.state.peers[0]===e.state.pid){n=0;for(var o=localStorage.length,a={};o--;){var u=localStorage.key(o),c=u?u.match(/\w{8}-\w{4}-\w{4}-\w{4}-\w{8}/gim):null;if(u&&c){var l=(c||[""])[0];a[l]||(a[l]=[]),a[l].push(u)}}Object.keys(a).forEach(function(t){a[t].length>10&&(e.state.peers=e.state.peers.filter(function(e){return e!==t}),a[t].forEach(function(e){localStorage.removeItem(e)}),localStorage.setItem("nsql-peers-"+e.state.id,JSON.stringify(e.state.peers)))})}}),window.onblur=function(){e.state.focused=!1},window.onfocus=function(){e.state.peers=e.state.peers.filter(function(t){return t!==e.state.pid}),e.state.peers.unshift(e.state.pid),localStorage.setItem("nsql-peers-"+e.state.id,JSON.stringify(e.state.peers)),e.state.focused=!0},t.nSQL("*").on("change",function(t){var n=e.state.peerEvents.indexOf(t.query.queryID||"");-1===n?e.state.peers.filter(function(t){return t!==e.state.pid}).forEach(function(e){localStorage.setItem(e+"."+t.query.queryID,JSON.stringify(t))}):e.state.peerEvents.splice(n,1)}),window.addEventListener("beforeunload",function(){return e.state.peers=e.state.peers.filter(function(t){return t!==e.state.pid}),localStorage.setItem("nsql-peers-"+e.state.id,JSON.stringify(e.state.peers)),!1})},e.prototype.on=function(e,t){var n=this,r="string"!=typeof n.state.selectedTable?"":n.state.selectedTable;if(-1!==r.indexOf("Plugin:"))return this.y[r]||(this.y[r]=new o.ReallySmallEvents),this.y[r].on(e,t),n.k();switch(e){case"connect":case"ready":case"disconnect":case"peer-change":case"slow-query":this.y.Core.on(e,t);break;default:var i="Table:"+s.resolveObjPath(r).join(".");this.y[i]||(this.y[i]=new o.ReallySmallEvents),this.y[i].on(e,t)}return n.k()},e.prototype.off=function(e,t){var n=this,r="string"!=typeof n.state.selectedTable?"":n.state.selectedTable;if(-1!==r.indexOf("Plugin:"))return this.y[r].off(e,t),n.k();switch(e){case"connect":case"ready":case"disconnect":case"peer-change":case"slow-query":this.y.Core.off(e,t);break;default:var i="Table:"+s.resolveObjPath(r).join(".");this.y[i].off(e,t)}return n.k()},e.prototype.k=function(){var e=this;return this.state.hasAnyEvents=Object.keys(this.y).reduce(function(t,n){return!0===t||Object.keys(e.y[n].eventListeners).reduce(function(t,r){return e.y[n].eventListeners[r].length+t},0)>0||t},!1),this},e.prototype.getView=function(e,t){return this.j("View",this.state.selectedTable,e,t)},e.prototype.doAction=function(e,t){return this.j("Action",this.state.selectedTable,e,t)},e.prototype.j=function(e,t,n,r){var i=this;return"string"!=typeof this.state.selectedTable?Promise.reject():this.doFilter(e,{result:{AVType:e,table:t,AVName:n,AVargs:r}}).then(function(e){var t="Action"===e.AVType?"actions":"views",n=i.tables[e.table][t].reduce(function(t,n){return n.name===e.AVName?n:t},null);return n?n.call(n.args?s.cleanArgs(n.args,e.AVargs):{},i):new Promise(function(t,n){return n(e.AVType+' "'+e.AVName+'" Not Found!')})})},e.prototype.query=function(e,t){var n=this.state.activeAV;return this.state.activeAV="",new y.A(this,this.state.selectedTable,e,t,n)},e.prototype.triggerQuery=function(e,t,n,r){var i=this;this.state.connected||"string"!=typeof e.table?this.doFilter("query",{result:e}).then(function(e){i.config.queue&&!e.skipQueue?g.push(function(o){new l.T(i,e,t,function(){o(),n()},function(e){o(),r(e)})}):new l.T(i,e,t,n,r)}).catch(r):r("nSQL: Can't do a query before the database is connected!")},e.prototype.triggerEvent=function(e){var t=this;return this.doFilter("event",{result:e}).then(function(n){t.state.hasAnyEvents&&t.y[e.target]&&s.setFast(function(){e.events.forEach(function(n){t.y[e.target].trigger(n,e)})})}).catch(function(e){console.error("Event suppressed",e)}),this},e.prototype.default=function(e,t){if(e=e||{},!t&&"string"!=typeof this.state.selectedTable)throw new Error("Must select table to generate defualts!");if(t=t||this.state.selectedTable,!this.tables[t])throw new Error('nSQL: Table "'+t+'" not found for generating default object!');var n="",r=function(e,t,i){var o={};if(i&&i.length&&-1!==i.indexOf("[]"))return Array.isArray(t)?t.map(function(t){return r(e,t,i.slice(0,i.lastIndexOf("[]")))}):[];var a=!1;if(e.forEach(function(e){if("*"!==e.key){if(e.model)if(-1!==e.type.indexOf("[]")){var i=void 0!==t?t[e.key]:[];Array.isArray(i)?o[e.key]=i.map(function(t){return r(e.model,t,e.type.slice(0,e.type.lastIndexOf("[]")))}):o[e.key]=[]}else o[e.key]=r(e.model,void 0!==t?t[e.key]:void 0);else o[e.key]=void 0!==t[e.key]?s.cast(e.type,o[e.key]):e.default;e.notNull&&null===o[e.key]&&(n="Data error, "+e.key+" cannot be null!")}else a=!0}),n.length)return new Error(n);if(a&&t){var u=e.map(function(e){return e.key});Object.keys(t).filter(function(e){return-1===u.indexOf(e)}).forEach(function(e){o[e]=t[e]})}return o};return r(this.tables[t].columns,e)},e.prototype.rawDump=function(e,t){var n=this,r=Object.keys(this.tables).filter(function(t){return!e.length||-1!==e.indexOf(t)});return s.chainAsync(r,function(e,r,i,o){n.adapter.readMulti(e,"all",void 0,void 0,!1,function(n){t(e,n)},i,o||s.noop)})},e.prototype.rawImport=function(e,t){var n=this,r=0,i=Object.keys(e).reduce(function(t,n){return t+e[n].length},0),o=Object.keys(this.tables),a=Object.keys(e).filter(function(e){return-1!==o.indexOf(e)});return s.chainAsync(a,function(o,a,u,c){var l=n.tables[o].pkCol;s.chainAsync(e[o],function(e,a,u,c){e[l]||!c?n.adapter.write(o,e[l],e,function(e){u(),r++,t&&t(Math.round(r/i*1e4)/100)},c||s.noop):c("No primary key found, can't import: "+JSON.stringify(e))}).then(u).catch(c)})},e.prototype.disconnect=function(){var e=this;return this.doFilter("disconnect",{}).then(function(){return new Promise(function(t,n){return e.adapter.disconnect(t,n)})})},e.prototype.observable=function(e,t){return new a.Observer(this,e,t||[])},e.prototype.extend=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this.doFilter("extend",{scope:e,args:t,result:null})},e.prototype.loadJS=function(e,t){return"string"!=typeof this.state.selectedTable?Promise.reject("nSQL: Can't load JS into temporary table!"):Promise.resolve([])},e.prototype.JSONtoCSV=function(e,t,n){var r=[];if(!e.length)return"";var i=[];return n?i=n:(e.forEach(function(e){i=Object.keys(e).concat(i)}),i=i.filter(function(e,t,n){return n.indexOf(e)===t})),t&&r.push(i.join(",")),e.forEach(function(e){r.push(i.map(function(t){return null===e[t]||void 0===e[t]?"":"string"==typeof e[t]?'"'+e[t].replace(/\"/g,'""')+'"':"boolean"==typeof e[t]?!0===e[t]?"true":"false":"object"==typeof e[t]?'"'+JSON.stringify(e[t]).replace(/\"/g,'""')+'"':e[t]}).join(","))}),r.join("\r\n")},e.prototype.csvToArray=function(e){for(var t,n="",r=[""],i=[r],o=0,s=0,a=!0,u=0,c=e;u<c.length;u++)'"'===(t=c[u])?(a&&t===n&&(r[o]+=t),a=!a):","===t&&a?t=r[++o]="":"\n"===t&&a?("\r"===n&&(r[o]=r[o].slice(0,-1)),r=i[++s]=[t=""],o=0):r[o]+=t,n=t;return i[0]},e.prototype.CSVtoJSON=function(e,t){var n=this,r=[];return e.split(/\r?\n|\r|\t/gm).map(function(e,i){if(0!==i){var o=n.csvToArray(e);if(o){o=o.map(function(e){return e.trim()});for(var s=r.length,a={};s--;)if(o[s])if("true"===o[s]||"false"===o[s])a[r[s]]="true"===o[s];else if(0===o[s].indexOf("{")||0===o[s].indexOf("["))try{a[r[s]]=JSON.parse(o[s])}catch(e){a[r[s]]=o[s]}else 0===o[s].indexOf('"')?a[r[s]]=o[s].slice(1,o[s].length-1).replace(/\"\"/gim,'"'):a[r[s]]=o[s];return t?t(a):a}}else r=e.split(",")}).filter(function(e){return e})},e.prototype.loadCSV=function(e,t,n){var i=this,o=this.state.selectedTable;if("string"!=typeof o)return Promise.reject("nSQL: Can't load CSV into temporary table!");var a=this.CSVtoJSON(e,t);return s.chainAsync(a,function(e,t,u,c){n&&n(Math.round((t+1)/a.length*1e4)/100),i.triggerQuery(r({},s.buildQuery(o,"upsert"),{actionArgs:e}),s.noop,u,c||s.noop)})},e}();t.NanoSQL=v;var b=new v;t.nSQL=function(e){return b.selectTable(e)},"undefined"!=typeof window&&(window["nano-sql"]={nSQL:t.nSQL,NanoSQLInstance:v})},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.eventListeners={}}return e.prototype.on=function(e,t){this.eventListeners[e]||(this.eventListeners[e]=[]),this.eventListeners[e].push(t)},e.prototype.off=function(e,t){var n=this;this.eventListeners[e]&&this.eventListeners[e].length&&this.eventListeners[e].forEach(function(r,i){r===t&&n.eventListeners[e].splice(i,1)})},e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.eventListeners[e]&&this.eventListeners[e].forEach(function(e){return e.apply(void 0,t)})},e}();t.ReallySmallEvents=n,t.RSE=new n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(0),o=function(){function e(e,t,n){this.M=e,this.I=t,this.P=n,this.C=[],this.L=0,this.x=[]}return e.prototype.debounce=function(e){return this.x[this.C.length]=e,this.C.push("dbnc"),this},e.prototype.distinct=function(e,t){return this.x[this.C.length]=[e||function(e){return e},t||function(e,t){return e===t}],this.C.push("dsct"),this},e.prototype.filter=function(e){return this.x[this.C.length]=e,this.C.push("fltr"),this},e.prototype.map=function(e){return this.x[this.C.length]=e,this.C.push("mp"),this},e.prototype.first=function(e){return this.x[this.C.length]=e||function(e,t){return!0},this.C.push("fst"),this},e.prototype.skip=function(e){return this.x[this.C.length]=e,this.C.push("skp"),this},e.prototype.take=function(e){return this.x[this.C.length]=e,this.C.push("tk"),this},e.prototype.subscribe=function(e){var t,n=this,i={},o={},s={},a={};return new r.INanoSQLObserverSubscriber(this.M,this.I,{next:function(r,u){if(n.L++,!t){var c=0,l=function(){if(c===n.C.length)"function"==typeof e?e(r,u):e.next&&e.next(r,u),t&&e.complete&&e.complete(r,u);else{var f=function(e){if(0===n.L)return 0;for(var t=e,r=n.L,i=!1;t--&&!i;)void 0!==a[t]&&(i=!0,r=a[t]);return r};switch(n.C[c]){case"dbnc":if(o[c]){clearTimeout(s[c]);var h=n.x[c];return void(s[c]=setTimeout(function(){Date.now()-o[c]>=h&&(o[c]=Date.now(),void 0===a[c]&&(a[c]=0),a[c]++,c++,l())},h-(Date.now()-o[c])))}o[c]=Date.now();break;case"dsct":var p=n.x[c][0](r,u);if(!1!==n.x[c][1](i[c],p))return;i[c]=p,void 0===a[c]&&(a[c]=0),a[c]++;break;case"fltr":if(!1===n.x[c](r,f(c),u))return;void 0===a[c]&&(a[c]=0),a[c]++;break;case"fst":if(!0!==n.x[c](r,f(c),u))return;void 0===a[c]&&(a[c]=0),a[c]++,t=!0;break;case"mp":r=n.x[c](r,f(c),u);break;case"skp":if(f(c)<=n.x[c])return;break;case"tk":f(c)>=n.x[c]&&(t=!0)}c++,l()}};l()}},error:function(t){e.error&&e.error(t)}},this.P)},e}();t.Observer=o;var s=function(){function e(e,t,n,r){var i=this;this.q=!1,this.exec=this.exec.bind(this),this.unsubscribe=this.unsubscribe.bind(this);var o=this.R();o&&(this.P=this.P.concat([o.table]),this.P=this.P.filter(function(e,t,n){return n.indexOf(e)===t}),this.exec()),this.P.forEach(function(e){i.M.selectTable(e).on("change",i.exec)})}return e.prototype.exec=function(e){var t=this;i.setFast(function(){t.R(e)})},e.prototype.unsubscribe=function(){var e=this;this.P.forEach(function(t){e.M.selectTable(t).off("change",e.exec)}),this.q=!0},e.prototype.closed=function(){return this.q},e}();t.ObserverSubscriber=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(7),o={};t.attachDefaultFns=function(e){e.functions={COUNT:{type:"A",aggregateStart:{result:0,row:{}},call:function(e,t,n,i,o){return o&&"*"!==o?r.objQuery(o,t,n)&&i.result++:i.result++,i.row=t,i}},MAX:{type:"A",aggregateStart:{result:void 0,row:{}},call:function(e,t,n,i,o){var s=r.objQuery(o,t,n)||0;return void 0===i.result?(i.result=s,i.row=t):s>i.result&&(i.result=s,i.row=t),i}},MIN:{type:"A",aggregateStart:{result:void 0,row:{}},call:function(e,t,n,i,o){var s=r.objQuery(o,t,n)||0;return void 0===i.result?(i.result=s,i.row=t):s<i.result&&(i.result=s,i.row=t),i}},GREATEST:{type:"S",call:function(e,t,n,i){for(var o=[],s=4;s<arguments.length;s++)o[s-4]=arguments[s];return{result:o.map(function(e){return isNaN(e)?r.getFnValue(t,e,n):parseFloat(e)}).sort(function(e,t){return e<t?1:-1})[0]}}},LEAST:{type:"S",call:function(e,t,n,i){for(var o=[],s=4;s<arguments.length;s++)o[s-4]=arguments[s];return{result:o.map(function(e){return isNaN(e)?r.getFnValue(t,e,n):parseFloat(e)}).sort(function(e,t){return e>t?1:-1})[0]}}},AVG:{type:"A",aggregateStart:{result:0,row:{},total:0,records:0},call:function(e,t,n,i,o){var s=parseFloat(r.objQuery(o,t,n)||0)||0;return i.total+=isNaN(s)?0:s,i.records++,i.result=i.total/i.records,i.row=t,i}},SUM:{type:"A",aggregateStart:{result:0,row:{}},call:function(e,t,n,i,o){var s=parseFloat(r.objQuery(o,t,n)||0)||0;return i.result+=isNaN(s)?0:s,i.row=t,i}},LOWER:{type:"S",call:function(e,t,n,i,o){return{result:String(r.getFnValue(t,o,n)).toLowerCase()}}},UPPER:{type:"S",call:function(e,t,n,i,o){return{result:String(r.getFnValue(t,o,n)).toUpperCase()}}},CAST:{type:"S",call:function(e,t,n,i,o,s){return{result:r.cast(s,r.objQuery(o,t,n))}}},CONCAT:{type:"S",call:function(e,t,n,i){for(var o=[],s=4;s<arguments.length;s++)o[s-4]=arguments[s];return{result:o.map(function(e){return r.getFnValue(t,e,n)}).join("")}}},LEVENSHTEIN:{type:"S",call:function(e,t,n,s,a,u){var c=r.getFnValue(t,a,n),l=r.getFnValue(t,u,n),f=c+"::"+l;return o[f]||(o[f]=i(c,l)),{result:o[f]}}},CROW:{type:"S",call:function(t,n,i,o,s,a,u){var c=r.objQuery(s+".lat",n,i),l=r.objQuery(s+".lon",n,i);return{result:r.crowDistance(c,l,parseFloat(a),parseFloat(u),e.earthRadius)}},whereIndex:function(e,t,n,i){if(">"===i[1]||">="===i[1]){var o="string"==typeof t.table?e.tables[t.table].indexes:{},s=r.resolveObjPath(n[0]),a=[];if(Object.keys(o).forEach(function(e){var t=o[e];r.compareObjects(t.path.slice(0,t.path.length-1),s)&&a.push(t.name.replace("-lat","").replace("-lon",""))}),2===a.length)return{index:a[0],fnName:"CROW",fnArgs:n,comp:i[1],value:i[2]}}return!1},queryIndex:function(e,t,n,r,i,o){}}},Object.getOwnPropertyNames(Math).forEach(function(t){e.functions[t.toUpperCase()]={type:"S",call:function(e,n,i,o){for(var s=[],a=4;a<arguments.length;a++)s[a-4]=arguments[a];var u=s.map(function(e){return parseFloat(isNaN(e)?r.objQuery(e,n,i):e)});return{result:Math[t].apply(null,u)}}}})}},function(e,t,n){"use strict";e.exports=function(e,t,n){var o,s,a,u,c,l,f,h;if(e===t)return 0;if(o=e.length,s=t.length,0===o)return s;if(0===s)return o;for(n&&(e=e.toLowerCase(),t=t.toLowerCase()),f=0;f<o;)i[f]=e.charCodeAt(f),r[f]=++f;for(h=0;h<s;)for(a=t.charCodeAt(h),u=c=h++,f=-1;++f<o;)l=a===i[f]?c:c+1,c=r[f],r[f]=u=c>u?l>u?u+1:l:l>c?c+1:l;return u};var r=[],i=[]},function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);e=e||{},this.concurrency=e.concurrency||1/0,this.pending=0,this.jobs=[],this.cbs=[],this.D=function(){this.pending--,this.J()}.bind(this)}["push","unshift","splice"].forEach(function(e){r.prototype[e]=function(){var t=Array.prototype[e].apply(this.jobs,arguments);return this.J(),t}}),Object.defineProperty(r.prototype,"length",{get:function(){return this.pending+this.jobs.length}}),r.prototype.J=function(){if(this.pending!==this.concurrency){if(this.jobs.length){var e=this.jobs.shift();this.pending++,e(this.D),this.J()}if(0===this.pending)for(;0!==this.cbs.length;){var t=this.cbs.pop();process.nextTick(t)}}},r.prototype.onDone=function(e){"function"==typeof e&&(this.cbs.push(e),this.J())},e.exports=r},function(e,t,n){var r=this&&this.h||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(0),s=function(){function e(e,t,n,r,i){var o=this;this.nSQL=e,this.query=t,this.progress=n,this.complete=r,this.error=i,this.F=[],this.Q=!0,this.W=[],this.U=!1,this.B=!1,this.V={},this.query.state="processing";var s=t.action.toLowerCase().trim();if("select"!==s&&"string"!=typeof t.table)return this.query.state="error",void this.error('Only "select" queries are available for this resource!');if("string"==typeof t.table&&!this.nSQL.state.connected)return this.query.state="error",void this.error("Can't execute query before the database has connected!");var a=function(e){return"string"!=typeof o.query.table?(o.query.state="error",void o.error(o.query.action+" query requires a string table argument!")):o.query.actionArgs?void e():(o.query.state="error",void o.error(o.query.action+" query requires an additional argument!"))},u=function(){"error"!==o.query.state&&(o.query.state="complete",o.complete())};switch(s){case"select":this.K(u,this.error);break;case"upsert":this.G(this.progress,this.complete);break;case"delete":this.H(this.progress,this.complete);break;case"show tables":this.X();break;case"describe":this.$();break;case"drop":case"drop table":this.dropTable(this.query.table,u,this.error);break;case"create table":case"create table if not exists":a(function(){o.createTable(o.query.actionArgs,u,o.error)});break;case"alter table":a(function(){o.alterTable(o.query.actionArgs,u,o.error)});break;case"create relation":a(function(){o.z(o.query.table,o.query.actionArgs,u,o.error)});break;case"drop relation":this.Y(this.query.table,u,this.error);break;case"rebuild index":this.Z(this.query.table,u,this.error);break;default:this.query.state="error",this.error('Query type "'+t.action+'" not supported!')}}return e.prototype.tt=function(e,t,n,i){var s,a=this;if(!e[0])return n(t),void i();var u=function(t,i,s){var c=e[i],l=0,f=[],h=0;if("cross"!==c.type&&!c.on)return a.query.state="error",void a.error("Non 'cross' joins require an 'on' parameter!");var p="Must use 'AS' when joining temporary tables!";if("string"!=typeof c.with.table&&!c.with.as)return a.query.state="error",void a.error(p);if("string"!=typeof a.query.table&&!a.query.tableAS)return a.query.state="error",void a.error(p);var y=function(e){return("string"==typeof e[0]?[e]:e).map(function(e){if(Array.isArray(e[0]))return y(e);if("AND"===e||"OR"===e)return e;var n=o.resolveObjPath(e[0]),r=o.resolveObjPath(e[2]),i=n[0]===(a.query.tableAS||a.query.table);return[i?r.slice(1).join("."):n.slice(1).join("."),i?-1!==e[1].indexOf(">")?e[1].replace(">","<"):e[1].replace("<",">"):e[1],o.objQuery(i?n:r,t)]})},d=function(t){e[i+1]?(h++,u(t,i+1,function(){h--,g()})):n(function(e){return Object.keys(e).reduce(function(t,n){var r=e[n];return r?(Object.keys(r).forEach(function(e){t[n+"."+e]=r[e]}),t):t},{})}(t))},g=function(){h||s()},v="string"==typeof c.with.table?a.nSQL.tables[c.with.table].pkCol:"",b=String(c.with.as||c.with.table),m=String(a.query.tableAS||a.query.table);a.nSQL.triggerQuery(r({},o.buildQuery(c.with.table,"select"),{tableAS:c.with.as,where:c.on&&"cross"!==c.type?y(c.on):void 0,skipQueue:!0}),function(e){var n;l++,"right"!==c.type&&"outer"!==c.type||f.push(v?e[v]:o.hash(JSON.stringify(e))),d(r({},t,((n={})[b]=e,n)))},function(){var e,n;switch(c.type){case"left":0===l&&d(r({},t,((e={})[b]=void 0,e))),g();break;case"inner":case"cross":g();break;case"outer":case"right":0===l&&"outer"===c.type&&d(r({},t,((n={})[b]=void 0,n))),a.nSQL.triggerQuery(r({},o.buildQuery(c.with.table,"select"),{skipQueue:!0,where:v?[v,"NOT IN",f]:void 0}),function(e){var n;(v||-1===f.indexOf(o.hash(JSON.stringify(e))))&&d(r({},t,((n={})[m]=void 0,n[b]=e,n)))},function(){g()},function(e){a.query.state="error",a.error(e)})}},function(e){a.query.state="error",a.error(e)})};u(((s={})[String(this.query.tableAS||this.query.table)]=t,s),0,i)},e.prototype.K=function(e,t){var n=this;if(this.nt=this.query.where?this.it(this.query.where,"string"!=typeof this.query.table||void 0!==this.query.union):{type:i.IWhereType.none},this.rt=this.query.having?this.it(this.query.having,!0):{type:i.IWhereType.none},this.et(),"error"!==this.query.state){if([this.query.orm,this.query.join,this.query.union].filter(function(e){return e}).length>1)return this.query.state="error",void t("Can only have one of orm, join or union!");var r=[this.query.offset||0,(this.query.offset||0)+(this.query.limit||0)],s=r[0]+r[1]>0;if(this.query.union){var a=[],u=[],c=0;o.chainAsync(this.query.union.queries,function(e,t,i){e().then(function(e){u.length||(u=Object.keys(e[0])),n.query.where&&(e=e.filter(function(e,t){return n.ut(e,n.nt.slowWhere,!1)})),e=e.map(function(e){if(n.query.union&&"distinct"===n.query.union.type){var r=o.hash(JSON.stringify(e));if(0===t)a.push(r);else{if(-1!==a.indexOf(r))return;a.push(r)}}return Object.keys(e).reduce(function(t,n,r){return r<u.length&&(t[u[r]]=e[n]),t},{})}).filter(function(e){return e}),n.query.orderBy?n.F=n.F.concat(e.map(function(e){var t=n.ot(e,!1);return!n.query.having||n.ut(t,n.rt.slowWhere,!1)?t:void 0}).filter(function(e){return e})):e.forEach(function(e,t){var i=n.ot(e,!1);(!n.query.having||n.ut(i,n.rt.slowWhere,!1))&&(s?c>=r[0]&&c<r[1]&&n.progress(n.ot(e,!1),c):n.progress(n.ot(e,!1),c),c++)}),i()})}).then(function(){if(n.query.orderBy){var t=n.F.sort(n.st);(s?t.slice(r[0],r[1]):t).forEach(n.progress)}e()})}else{var l=Array.isArray(this.query.join)?this.query.join:[this.query.join],f=!1,h=0;!this.Q||this.query.join||this.query.orderBy||this.query.having||this.query.groupBy||(f=!0);var p=function(){if(0===h){if(f||n.Q)return void e();n.ct(),n.query.having&&(n.F=n.F.filter(function(e){return n.ut(e,n.rt.slowWhere,void 0!==n.query.join)})),n.query.orderBy&&n.F.sort(n.st),s&&(n.F=n.F.slice(r[0],r[1])),n.F.forEach(function(e,t){n.progress(e,r[0]+t)}),e()}};this.ft(function(e,t){if(f)s?t>=r[0]&&t<r[1]&&n.progress(n.W.length?n.ot(e,!1):e,t):n.progress(n.W.length?n.ot(e,!1):e,t);else{e=o.a(e);var i=0;h++,n.tt(l,e,function(e){if(n.Q){var t=!0;e=n.W.length?n.ot(e,void 0!==n.query.join):e,n.query.having&&(t=n.ut(e,n.rt.slowWhere,void 0!==n.query.join)),t&&s&&(t=i>=r[0]&&i<r[1]),t&&n.progress(e,i),i++}else n.F.push(e)},function(){h--,p()})}},p)}}},e.prototype.ct=function(){var e=this;this.query.groupBy?(this.F.sort(function(t,n){return e.at(t,n,e.ht)}).forEach(function(t,n){var r=e.ht.sort.map(function(n){return String(o.objQuery(n.path,t,void 0!==e.query.join))}).join(".");e.V[r]||(e.V[r]=[]),e.V[r].push(t)}),this.F=[],this.lt?Object.keys(this.V).forEach(function(t){var n=e.W.reduce(function(t,n){return"A"===e.nSQL.functions[n.value].type&&(t[n.value]={aggr:e.nSQL.functions[n.value].aggregateStart,args:n.args}),t},{}),r=Object.keys(n)[0];e.V[t].forEach(function(t,r){Object.keys(n).forEach(function(r){var i;n[r].aggr=(i=e.nSQL.functions[r]).call.apply(i,[e.query,t,void 0!==e.query.join,n[r].aggr].concat(n[r].args))})}),e.F.push(e.W.reduce(function(t,i){var s;return t[i.as||i.value]=i.isFn&&n[i.value]?n[i.value].aggr.result:i.isFn?(s=e.nSQL.functions[i.value]).call.apply(s,[e.query,n[r].aggr.row,void 0!==e.query.join,{}].concat(i.args||[])):o.objQuery(i.value,n[r].aggr.row),t},{}))}):Object.keys(this.V).forEach(function(t){e.V[t].forEach(function(t){e.F.push(e.ot(t,void 0!==e.query.join))})})):this.F=this.F.map(function(t){return e.ot(t,void 0!==e.query.join)})},e.prototype.G=function(e,t){var n=this;if(this.query.actionArgs||(this.error("Can't upsert without records!"),this.query.state="error"),this.nt=this.query.where?this.it(this.query.where):{type:i.IWhereType.none},"error"!==this.query.state){var r=Array.isArray(this.query.actionArgs)?this.query.actionArgs:[this.query.actionArgs],s=this.nSQL.tables[this.query.table];if(r=r.map(function(e){return n.nSQL.default(e,n.query.table)}),this.nt.type===i.IWhereType.none)o.allAsync(r,function(e,t,r,i){e[s.pkCol]?n.nSQL.adapter.read(n.query.table,e[s.pkCol],function(t){t?n.vt(e,t,r,i):n.dt(e,r,i)},function(t){n.dt(e,r,i)}):n.dt(e,r,i)}).then(function(){e({result:r.length+" row(s) upserted"},0),t()});else{if(r.length>1)return this.query.state="error",void this.error("Cannot upsert multiple records with where condition!");var a=function(){l&&0===u&&(e({result:c+" row(s) upserted"},0),t())},u=0,c=0,l=!1;this.ft(function(e,t){u++,c++,n.vt(r[0],e,function(){u--,a()},function(e){n.query.state="error",n.error(e)})},function(){l=!0,a()})}}},e.prototype.vt=function(e,t,n,i){var s=this;this.nSQL.doFilter("updateRow",{result:e,row:t,query:this.query}).then(function(e){var i=r({},t,e),a=s.pt(s.nSQL.tables[s.query.string].indexes,i),u=s.pt(s.nSQL.tables[s.query.string].indexes,t),c=s.nSQL.tables[s.query.table];o.allAsync(Object.keys(u).concat(["__pk__"]),function(e,t,n,r){if("__pk__"===e)s.nSQL.adapter.write(s.query.table,i[c.pkCol],i,function(e){i[c.pkCol]=e,n(null)},r);else{var l="_idx_"+s.query.table+"_"+e;a[e]!==u[e]?o.allAsync(["rm","add"],function(t,n,r){switch(t){case"add":s.nSQL.adapter.read(l,a[e],function(t){(t=o.a(t||function(e){return{id:e,pks:[]}}(a[e]))).pks.push(i[c.pkCol]),s.nSQL.adapter.write(l,a[e],t,function(){r(null)},function(){r(null)})},function(e){r(null)});break;case"rm":s.nSQL.adapter.read(l,u[e],function(t){var n=(t=o.a(t)).pks.indexOf(i[c.pkCol]);-1!==n?((t.pks||[]).splice(n,1),s.nSQL.adapter.write(l,u[e],t,function(){r(null)},function(){r(null)})):r(null)},function(e){r(null)})}}).then(n):n(null)}}).then(function(){s.nSQL.doFilter("updatedRow",{result:i,new:!1}),n(i)})}).catch(i)},e.prototype.dt=function(e,t,n){var r=this;this.nSQL.doFilter("addRow",{result:e,query:this.query}).then(function(e){var n=r.pt(r.nSQL.tables[r.query.string].indexes,e),i=r.nSQL.tables[r.query.table];o.allAsync(Object.keys(n).concat(["__pk__"]),function(t,s,a,u){if("__pk__"===t)r.nSQL.adapter.write(r.query.table,e[i.pkCol],e,function(t){e[i.pkCol]=t,a(null)},u);else{var c="_idx_"+r.query.table+"_"+t;r.nSQL.adapter.read(c,n[t],function(s){(s=o.a(s||{id:n[t],pks:[]})).pks.push(e[i.pkCol]),r.nSQL.adapter.write(c,n[t],s,function(){a(null)},function(){a(null)})},function(e){a(null)})}}).then(function(){r.nSQL.doFilter("updatedRow",{result:e,new:!0}),t(e)})}).catch(n)},e.prototype.H=function(e,t){var n=this;if(this.nt=this.query.where?this.it(this.query.where):{type:i.IWhereType.none},"error"!==this.query.state)if(this.nt.type===i.IWhereType.none)this.query.state="error",this.error("Can't do delete query without where condition!");else{var r=0,s=0,a=!1,u=this.nSQL.tables[this.query.table],c=function(){a&&0===r&&(e({result:s+" row(s) deleted"},0),t())};this.ft(function(e,t){r++,n.nSQL.doFilter("deleteRow",{result:e,query:n.query}).then(function(t){var i=n.pt(u.indexes,e);o.allAsync(Object.keys(i).concat(["__del__"]),function(r,s,a){if("__del__"===r)n.nSQL.adapter.delete(n.query.table,t[u.pkCol],function(){a(null)},function(e){n.query.state="error",n.error(e)});else{var c="_idx_"+n.query.table+"_"+r;n.nSQL.adapter.read(c,i[r],function(t){var s=(t=o.a(t)).pks.indexOf(e[u.pkCol]);-1!==s?(t.pks.splice(s,1),n.nSQL.adapter.write(c,i[r],t,function(){a(null)},function(){a(null)})):a(null)},function(e){a(null)})}}).then(function(){r--,s++,c()}).catch(function(e){n.query.state="error",n.error(e)})}).catch(function(){r--,c()})},function(){a=!0,c()})}},e.prototype.pt=function(e,t){return Object.keys(e).reduce(function(n,r){return n[r]=o.cast(e[r].type,o.objQuery(e[r].path,t)),n},{})},e.prototype.X=function(){this.progress({tables:Object.keys(this.nSQL.tables)},0),this.complete()},e.prototype.$=function(){return"string"!=typeof this.query.table?(this.query.state="error",void this.error("Can't call describe on that!")):this.nSQL.tables[this.query.table]?(this.progress({describe:o.u(this.nSQL.tables[this.query.table].columns)},0),void this.complete()):(this.query.state="error",void this.error("Table "+this.query.table+" not found!"))},e.prototype.z=function(e,t,n,r){var i=this;new Promise(function(n,r){return i.nSQL.doFilter("registerRelation",{result:{name:e,rel:t}})}).then(function(e){return new Promise(function(t,n){var r={left:o.resolveObjPath(e.rel[0]),sync:e.rel[1],right:o.resolveObjPath(e.rel[2])};if(-1===["<=","<=>","=>"].indexOf(r.sync)||r.left.length<2||r.right.length<2)n("Invalid relation!");else{var s=Object.keys(i.nSQL.tables);-1!==s.indexOf(r.left[0])?-1!==s.indexOf(r.right[0])?(i.nSQL.relations[e.name]=r,t(i.nSQL.relations[e.name])):n("Relation error, can't find table "+r.right[0]+"!"):n("Relation error, can't find table "+r.left[0]+"!")}})}).then(n).catch(r)},e.prototype.Y=function(e,t,n){var r=this;new Promise(function(t,n){return r.nSQL.doFilter("destroyRelation",{result:e})}).then(function(e){return new Promise(function(t,n){r.nSQL.relations[e]?(delete r.nSQL.relations[e],t(e)):n("Relation "+e+" not found!")})}).then(t).catch(n)},e.prototype.ot=function(e,t){var n=this;if(this.W.length){var r={};return this.W.forEach(function(i){var s;n.nSQL.functions[i.value]||(n.query.state="error",n.error("Function "+i.value+" not found!")),i.isFn?r[i.as||i.value]=(s=n.nSQL.functions[i.value]).call.apply(s,[n.query,e,t,{}].concat(i.args||[])):r[i.as||i.value]=o.objQuery(i.value,e,t)}),r}return e},e.prototype.st=function(e,t){return this.at(e,t,this.bt)},e.prototype.at=function(e,t,n){return n.sort.reduce(function(n,r){var i=o.objQuery(r.path,e),s=o.objQuery(r.path,t);return n||(i===s?0:(i>s?1:-1)*("DESC"===r.dir?-1:1))},0)},e.prototype.createTable=function(e,t,n){var i=this;new Promise(function(t,n){var i=!1,o=e.name;e.S||0!==o.indexOf("_")&&null===o.match(/\s/g)&&null===o.match(/[\(\)\]\[\.]/g)?(e.model.forEach(function(t){var r=t.key.split(":");1===r.length&&r.push("any"),r[0]&&null===r[0].match(/[\(\)\]\[\.]/g)&&0!==r[0].indexOf("_")||(i=!0,n("nSQL: Invalid Data Model at "+e.name+", "+JSON.stringify(t)+"! https://docs.nanosql.io/setup/data-models"))}),e.model=e.model.map(function(e){return r({},e,{name:e.key.replace(/\s+/g,"-")})}),i||t()):n("nSQL: Invalid Table Name "+e.name+"! https://docs.nanosql.io/setup/data-models")}).then(function(){return i.nSQL.doFilter("createTable",{result:e})}).then(function(e){return new Promise(function(t,n){var r=function(e){return e.map(function(e){return 0===(e.key.split(":")[1]||"any").indexOf("geo")&&(e.model=[{key:"lat:float",default:0},{key:"lon:float",default:0}]),e.model&&(e.model=r(e.model)),e})},s=function(e){return e.filter(function(e){return"*"!==e.key}).map(function(e){return{key:e.key.split(":")[0],type:e.key.split(":")[1]||"any",default:e.default||null,notNull:!(!e.props||-1===e.props.indexOf("not_null()")),model:e.model?s(e.model):void 0}})},a=!1,u=r(e.model);if(i.nSQL.tables[e.name]={model:u,columns:s(u),actions:e.actions||[],views:e.views||[],indexes:(e.indexes||[]).map(function(e){return{name:e.name.split(":")[0],type:e.name.split(":")[1]||"string",path:o.resolveObjPath(e.path)}}).reduce(function(e,t){return-1===Object.keys(i.nSQL.indexTypes).indexOf(t.type)?(a=!0,n('Index "'+t.name+'" does not have a valid type!'),e):(-1!==t.type.indexOf("geo")?(e[t.name+"-lat"]={name:t.name+"-lat",type:"float",path:t.path.concat(["lat"])},e[t.name+"-lon"]={name:t.name+"-lon",type:"float",path:t.path.concat(["lon"])}):e[t.name]=e,e)},{}),pkType:e.model.reduce(function(e,t){return t.props&&-1!==t.props.indexOf("pk()")?t.key.split(":")[1]:e},""),pkCol:e.model.reduce(function(e,t){return t.props&&-1!==t.props.indexOf("pk()")?t.key.split(":")[0]:e},""),ai:e.model.reduce(function(e,t){return!(!t.props||-1===t.props.indexOf("pk()")||-1===t.props.indexOf("ai()"))||e},!1)},""===i.nSQL.tables[e.name].pkCol&&(i.nSQL.tables[e.name].pkCol="_id_",i.nSQL.tables[e.name].pkType="uuid",i.nSQL.tables[e.name].model.unshift({key:"_id_:uuid",props:["pk()"]}),i.nSQL.tables[e.name].columns=s(i.nSQL.tables[e.name].model)),!a){var c=[e.name];Object.keys(i.nSQL.tables[e.name].indexes).forEach(function(t,n){var r=i.nSQL.tables[e.name].indexes[t],o="_idx_"+e.name+"_"+r.name;c.push(o),i.nSQL.tables[o]={model:[{key:"id:"+(r.type||"uuid"),props:["pk()"]},{key:"pks:"+i.nSQL.tables[e.name].pkType+"[]"}],columns:[{key:"id",type:r.type||"uuid"},{key:"pks",type:i.nSQL.tables[e.name].pkType+"[]"}],actions:[],views:[],indexes:{},pkType:r.type,pkCol:"id",ai:!1}}),o.allAsync(c,function(e,t,n,r){i.nSQL.adapter.createTable(e,i.nSQL.tables[e],n,r)}).then(t).catch(n)}}).then(t).catch(n)})},e.prototype.alterTable=function(e,t,n){var r=this;this.nSQL.doFilter("alterTable",{result:e}).then(function(i){var s=[i.name];Object.keys(r.nSQL.tables[e.name].indexes).forEach(function(e){s.push("_idx_"+i.name+"_"+e)}),o.allAsync(s,function(e,t,n,o){r.nSQL.adapter.disconnectTable(i.name,n,o)}).then(function(){r.createTable(i,t,n)}).catch(n)}).catch(n)},e.prototype.dropTable=function(e,t,n){var r=this;this.nSQL.doFilter("destroyTable",{result:[e]}).then(function(e){var i=e;e.forEach(function(e){Object.keys(r.nSQL.tables[e].indexes).forEach(function(t){i.push("_idx_"+e+"_"+t)})}),o.allAsync(i,function(e,t,n,i){r.nSQL.adapter.dropTable(e,function(){delete r.nSQL.tables[e],n(e)},i)}).then(t).catch(n)})},e.prototype.yt=function(e){this.query.state="error",this.error(e)},e.prototype.gt=function(e,t,n,r,i,s,a){var u=this;switch(n.comp){case"=":e?(s(n.value,0),a()):this.nSQL.adapter.read(t,n.value,function(e){s(e,0),a()},this.yt);break;case"BETWEEN":(e?this.nSQL.adapter.readMultiPK:this.nSQL.adapter.readMulti)(t,"range",n.value[0],n.value[1],r,function(e,t){s(e,t)},a,this.yt);break;case"IN":var c=i?r?n.value.sort(function(e,t){return e<t?1:-1}):n.value.sort(function(e,t){return e>t?1:-1}):n.value;e?(c.forEach(function(e,t){s(e,t)}),a()):o.chainAsync(c,function(e,n,r){u.nSQL.adapter.read(t,e,function(e){s(e,n),r()},u.yt)}).then(a)}},e.prototype.wt=function(e,t){var n=this;if(this.nt.fastWhere)if(1===this.nt.fastWhere.length){var r=this.nt.fastWhere[0],i=this.U&&"DESC"===this.bt.sort[0].dir;r.index&&r.fnName?this.nSQL.functions[r.fnName].queryIndex(this.nSQL,this,r,!1,e,t):r.col===this.nSQL.tables[this.query.table].pkCol?this.gt(!1,this.query.table,r,i,this.U,e,t):this.mt(!1,r,e,t)}else{var s={},a=0;o.chainAsync(this.nt.fastWhere,function(e,t,r){if(t%2!=1){a=t;var i=function(e){s[e]=t};e.index&&e.fnName?n.nSQL.functions[e.fnName].queryIndex(n.nSQL,n,e,!0,i,r):e.col===n.nSQL.tables[n.query.table].pkCol?n.gt(!0,n.query.table,e,!1,!1,i,r):n.mt(!0,e,i,r)}else r()}).then(function(){var r=[];Object.keys(s).forEach(function(e){s[e]===a&&r.push(e)}),n.gt(!1,n.query.table,{index:"_pk_",col:n.nSQL.tables[n.query.table].pkCol,comp:"IN",value:r},!1,!1,function(t,n){e(t,n)},t)})}},e.prototype.mt=function(e,t,n,r){var i=this;if(this.nSQL.tables[this.query.table].indexes[t.index]){var s=!1,a=!1,u=0,c=0,l=function(){h.length?i.gt(!1,i.query.table,{index:"_pk_",col:i.nSQL.tables[i.query.table].pkCol,comp:"IN",value:h.shift().pks},!1,!1,function(e){n(e,u),u++},function(){u%100==0?o.setFast(l):l()}):s?r():o.setFast(function(){++c>1e3?setTimeout(l,Math.min(c/10,1e3)):l()})},f="_idx_"+this.query.table+"_"+t.index,h=[],p=[],y=this.B&&"DESC"===this.bt.sort[0].dir;this.gt(!1,f,t,y,this.B,function(t){e?p=p.concat(t.pks||[]):(h.push(t),a||(a=!0,l()))},function(){if(s=!0,e){for(var t=0;t<p.length;)n(p[t],t),t++;r()}})}else this.yt("Index not found!")},e.prototype.ft=function(e,t){var n=this,r=function(r){for(var o=0;o<r.length;)n.nt.type!==i.IWhereType.none?n.nt.whereFn?n.nt.whereFn(r[o],o)&&e(r[o],o):n.ut(r[o],n.nt.slowWhere,void 0!==n.query.join)&&e(r[o],o):e(r[o],o),o++;t()};if("string"==typeof this.query.table)switch(this.nt.type){case i.IWhereType.fast:this.wt(e,t);break;case i.IWhereType.medium:this.wt(function(t,r){n.ut(t,n.nt.slowWhere,!1)&&e(t,r)},t);break;case i.IWhereType.slow:case i.IWhereType.none:case i.IWhereType.fn:var o=this.U&&"DESC"===this.bt.sort[0].dir;this.nSQL.adapter.readMulti(this.query.table,"all",void 0,void 0,o,function(t,r){n.nt.type===i.IWhereType.slow?n.ut(t,n.nt.slowWhere,!1)&&e(t,r):n.nt.type===i.IWhereType.fn&&n.nt.whereFn?n.nt.whereFn(t,r)&&e(t,r):e(t,r)},t,function(e){n.query.state="error",n.error(e)})}else"function"==typeof this.query.table?this.query.table().then(r).catch(function(e){n.error(e)}):Array.isArray(this.query.table)&&r(this.query.table)},e.prototype.Z=function(e,t,n){},e.prototype.ut=function(e,t,n){if(t.length>1){for(var r=!0;0<t.length;){var i=t[0];r=Array.isArray(i[0])?this.ut(e,i,n||!1):this.Ot(i,e,n||!1)}return r}return this.Ot(t[0],e,n||!1)},e.prototype._t=function(t,n){if(!e.likeCache[n]){var r="";e.likeCache[n]=new RegExp(n.split("").map(function(e){return"\\"===r?(r=e,e):(r=e,"%"===e?".*":"_"===e?".":e)}).join(""),"gmi")}return"string"!=typeof t?"number"==typeof t?null!==String(t).match(e.likeCache[n]):null!==JSON.stringify(t).match(e.likeCache[n]):null!==t.match(e.likeCache[n])},e.prototype.St=function(e,t,n){var r;return e.fnName?(r=this.nSQL.functions[e.fnName]).call.apply(r,[this.query,t,n,this.nSQL.functions[e.fnName].aggregateStart||{result:void 0}].concat(e.fnArgs||[])):o.objQuery(e.col,t,n)},e.prototype.Ot=function(e,t,n){var r=this.St(e,t,n),i=e.value,s=e.comp;if("NULL"===i||"NOT NULL"===i){var a=-1!==[void 0,null,""].indexOf(r),u="="===s||"LIKE"===s;switch(i){case"NULL":return u?a:!a;case"NOT NULL":return u?!a:a}}if(-1!==["IN","NOT IN","BETWEEN","INTERSECT","INTERSECT ALL","NOT INTERSECT"].indexOf(s)&&!Array.isArray(i))return this.query.state="error",this.query.error('WHERE "'+s+'" comparison requires an array value!'),!1;switch(s){case"=":return o.compareObjects(i,r);case"!=":return!o.compareObjects(i,r);case">":return r>i;case"<":return r<i;case"<=":return r<=i;case">=":return r>=i;case"IN":return-1!==i.indexOf(r);case"NOT IN":return-1===i.indexOf(r);case"REGEXP":case"REGEX":return null!==(r||"").match(i);case"LIKE":return this._t(r||"",i);case"NOT LIKE":return!this._t(r||"",i);case"BETWEEN":return i[0]<=r&&i[1]>r;case"INCLUDES":return-1!==(r||[]).indexOf(i);case"NOT INCLUDES":return-1===(r||[]).indexOf(i);case"INTERSECT":return(r||[]).filter(function(e){return i.indexOf(e)>-1}).length>0;case"INTERSECT ALL":return(r||[]).filter(function(e){return i.indexOf(e)>-1}).length===i.length;case"NOT INTERSECT":return 0===(r||[]).filter(function(e){return i.indexOf(e)>-1}).length;default:return!1}},e.prototype.Nt=function(t,n){var r=t&&t.length?o.hash(JSON.stringify(t)):"";if(!r)return{sort:[],index:""};if(e.kt[r])return e.kt[r];var i=t.map(function(e){return e.split(" ").map(function(e){return e.trim()})}).reduce(function(e,t){return e.push({path:o.resolveObjPath(t[0]),dir:(t[1]||"asc").toUpperCase()}),e},[]),s="";if(n&&1===i.length){var a="string"==typeof this.query.table?this.nSQL.tables[this.query.table].pkCol:"";if(i[0].path[0].length&&i[0].path[0]===a)s="_pk_";else for(var u=Object.keys(this.nSQL.tables[this.query.table].indexes),c=u.length;c--&&!s;)o.compareObjects(this.nSQL.tables[this.query.table].indexes[u[c]],i[0].path)&&(s=this.nSQL.tables[this.query.table].indexes[u[c]].name)}return e.kt[r]={sort:i,index:s},e.kt[r]},e.prototype.et=function(){var t=this,n=this.query.actionArgs&&this.query.actionArgs.length?JSON.stringify(this.query.actionArgs):"";this.bt=this.Nt(this.query.orderBy||[],"string"==typeof this.query.table),this.ht=this.Nt(this.query.groupBy||[],!1),n?e.jt[n]?(this.lt=e.jt[n].hasAggrFn,this.W=e.jt[n].args):((this.query.actionArgs||[]).forEach(function(e){var n=e.split(/\s+as\s+/i).map(function(e){return e.trim()});if(-1!==n[0].indexOf("(")){var r=n[0].split("(")[1].replace(")","").split(",").map(function(e){return e.trim()}),i=n[0].split("(")[0].trim().toUpperCase();t.W.push({isFn:!0,value:i,as:n[1],args:r}),t.nSQL.functions[i]?"A"===t.nSQL.functions[i].type&&(t.lt=!0):(t.query.state="error",t.error('Function "'+i+'" not found!'))}else t.W.push({isFn:!1,value:n[0],as:n[1]})}),"error"!==this.query.state&&(e.jt[n]={hasAggrFn:this.lt,args:this.W})):this.W=[];var r=!1;this.nt.type===i.IWhereType.none?(r="_pk_"===this.bt.index)&&(this.U=!0):(r=!!(this.bt.index.length&&this.nt.fastWhere&&o.compareObjects(this.nt.fastWhere[0].col,this.bt.sort[0].path)))&&(this.B=!0),(this.bt.sort.length&&!r||this.ht.sort.length||this.lt)&&(this.Q=!1)},e.prototype.it=function(t,n){var r=this,s=t||[],a=JSON.stringify(s)+(n?"0":"1");if(e.Et[a])return e.Et[a];if("function"==typeof s)return{type:i.IWhereType.fn,whereFn:s};if(!s.length)return e.Et[a]={type:i.IWhereType.none},e.Et[a];for(var u="string"==typeof this.query.table?Object.keys(this.nSQL.tables[this.query.table].indexes).map(function(e){return r.nSQL.tables[r.query.table].indexes[e]}):[],c="string"==typeof this.query.table?this.nSQL.tables[this.query.table].pkCol:"",l=function(e,t){var i=!n&&0===t;return e.reduce(function(e,n,s){if(s%2==1)return"string"!=typeof n?(r.query.state="error",r.error("Malformed WHERE statement!"),e):(e.push(n),e);if(!Array.isArray(n))return r.query.state="error",r.error("Malformed WHERE statement!"),e;if(Array.isArray(n[0]))e.push(l(n,t+1));else{if(-1===n[0].indexOf("(")){var a=!1;if(["=","BETWEEN","IN"].indexOf(n[1])&&i)if(n[0]===c)a=!0,e.push({index:"_pk_",col:n[0],comp:n[1],value:n[2]});else{var f=o.resolveObjPath(n[0]);u.forEach(function(t){o.compareObjects(t.path,f)&&(a=!0,e.push({index:t.name,col:n[0],comp:n[1],value:n[2]}))})}return a||e.push({col:n[0],comp:n[1],value:n[2]}),e}var h=n[0].split("(")[1].replace(")","").split(",").map(function(e){return e.trim()}).filter(function(e){return e}),p=n[0].split("(")[0].trim().toUpperCase(),y=!1;if(!r.nSQL.functions[p])return r.query.state="error",r.error('Function "'+p+'" not found!'),e;if(i&&r.nSQL.functions[p]&&r.nSQL.functions[p].whereIndex){var d=r.nSQL.functions[p].whereIndex(r.nSQL,r.query,h,n);d&&(y=!0,e.push(d))}y||e.push({fnName:p,fnArgs:h,comp:n[1],value:n[2]})}},[])},f=l("string"==typeof s[0]?[s]:s,0),h=!0,p=0,y=-1;p<f.length&&h;)p%2==1?"AND"!==f[p]&&(h=!1,y=p):!Array.isArray(f[p])&&f[p].index||(h=!1,y=p),p++;if(y%2==0&&y++,-1===y||"AND"!==f[y]&&f[y])e.Et[a]={type:i.IWhereType.slow,slowWhere:f};else{var d=f.slice(y+1);e.Et[a]={type:d.length?i.IWhereType.medium:i.IWhereType.fast,slowWhere:d,fastWhere:f.slice(0,y)}}return e.Et[a]},e.likeCache={},e.jt={},e}();t.T=s},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.useLS=e,this.plugin={name:"Sync Storage Adapter",version:2,dependencies:{core:[2]}}}return e.prototype.connect=function(e,t,n){},e.prototype.createTable=function(e,t,n,r){},e.prototype.disconnectTable=function(e,t,n){},e.prototype.dropTable=function(e,t,n){},e.prototype.disconnect=function(e,t){},e.prototype.write=function(e,t,n,r,i){},e.prototype.read=function(e,t,n,r){},e.prototype.delete=function(e,t,n,r){},e.prototype.readMulti=function(e,t,n,r,i,o,s,a){},e.prototype.readMultiPK=function(e,t,n,r,i,o,s,a){},e.prototype.getIndex=function(e,t,n){},e.prototype.getNumberOfRecords=function(e,t,n){},e}();t.SyncStorage=n},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.plugin={name:"WebSQL Adapter",version:2,dependencies:{core:[2]}}}return e.prototype.connect=function(e,t,n){},e.prototype.createTable=function(e,t,n,r){},e.prototype.disconnectTable=function(e,t,n){},e.prototype.dropTable=function(e,t,n){},e.prototype.disconnect=function(e,t){},e.prototype.write=function(e,t,n,r,i){},e.prototype.read=function(e,t,n,r){},e.prototype.delete=function(e,t,n,r){},e.prototype.readMulti=function(e,t,n,r,i,o,s,a){},e.prototype.readMultiPK=function(e,t,n,r,i,o,s,a){},e.prototype.getIndex=function(e,t,n){},e.prototype.getNumberOfRecords=function(e,t,n){},e}();t.WebSQL=n},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.plugin={name:"IndexedDB Adapter",version:2,dependencies:{core:[2]}}}return e.prototype.connect=function(e,t,n){},e.prototype.createTable=function(e,t,n,r){},e.prototype.disconnectTable=function(e,t,n){},e.prototype.dropTable=function(e,t,n){},e.prototype.disconnect=function(e,t){},e.prototype.write=function(e,t,n,r,i){},e.prototype.read=function(e,t,n,r){},e.prototype.delete=function(e,t,n,r){},e.prototype.readMulti=function(e,t,n,r,i,o,s,a){},e.prototype.readMultiPK=function(e,t,n,r,i,o,s,a){},e.prototype.getIndex=function(e,t,n){},e.prototype.getNumberOfRecords=function(e,t,n){},e}();t.IndexedDB=n},function(e,t,n){var r=this&&this.h||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(){function e(e,t,n,o,s){this.At=e,this.Tt=s||"",this.I="string"==typeof n?r({},i.buildQuery(t,n),{comments:[],state:"pending",action:n,actionArgs:o,result:[]}):r({},i.buildQuery(t,""),n(e),{state:"pending"})}return e.prototype.where=function(e){return this.I.where=e,this},e.prototype.orderBy=function(e){return this.I.orderBy=e,this},e.prototype.groupBy=function(e){return this.I.groupBy=e,this},e.prototype.having=function(e){return this.I.having=e,this},e.prototype.join=function(e){var t=this,n="Join commands requires table and type arguments!";return Array.isArray(e)?e.forEach(function(e){e.with.table&&e.type||(t.Mt=n)}):e.with.table&&e.type||(this.Mt=n),this.I.join=e,this},e.prototype.limit=function(e){return this.I.limit=e,this},e.prototype.comment=function(e){return this.I.comments.push(e),this},e.prototype.extend=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this.I.extend.push({scope:e,args:t}),this},e.prototype.union=function(e,t){return this.I.union={queries:e,type:t?"all":"distinct"},this},e.prototype.offset=function(e){return this.I.offset=e,this},e.prototype.emit=function(){return this.I},e.prototype.ttl=function(e,t){if(void 0===e&&(e=60),"upsert"!==this.I.action)throw new Error("nSQL: Can only do ttl on upsert queries!");return this.I.ttl=e,this.I.ttlCols=t||[],this},e.prototype.orm=function(e){return this.I.orm=e,this},e.prototype.from=function(e,t){return this.I.table=e,this.I.tableAS=t?t.AS:"",this},e.prototype.toCSV=function(e){var t=this;return t.exec().then(function(n){return Promise.resolve(t.At.JSONtoCSV(n,e))})},e.prototype.exec=function(){var e=this;return new Promise(function(t,n){var r=[];e.stream(function(e){r.push(e)},function(){t(r)},n)})},e.prototype.stream=function(e,t,n){this.At.triggerQuery(this.I,e,t,n)},e.prototype.cache=function(){var e=this;return new Promise(function(t,n){var r=i.uuid();e.exec().then(function(n){e.At.b[r]=n,t({id:r,total:n.length})}).catch(n)})},e}();t.A=o}])});